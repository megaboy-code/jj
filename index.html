<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ§  MEGA FLOWZ - Professional Trading Dashboard</title>
  
  <!-- Google Fonts for Professional Typography -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- Local Styles -->
  <link rel="stylesheet" href="pyramid_chart.css">
  <link rel="stylesheet" href="analysis_alerts.css">
</head>
<body>
  <div class="tabs-container">
    <div class="tabs-header">
      <button class="tab active" onclick="switchTab('pyramid')">ğŸ”ï¸ Pyramid</button>
      <button class="tab" onclick="switchTab('chart')">ğŸ“ˆ Chart</button>
      <button class="tab" onclick="switchTab('analysis')">ğŸ“Š Analysis</button>
      <button class="tab" onclick="switchTab('alerts')">ğŸ”” Alerts</button>
    </div>

    <div id="pyramid-tab" class="tab-content active">
      <div class="header">
        <h1>ğŸ§  MEGA FLOWZ - Professional Trading Dashboard</h1>
        
        <!-- Pyramid Controls -->
        <div class="pyramid-style-selector">
          <div class="style-controls">
            <!-- Pairs Dropdown - EUR/USD as default -->
            <select id="pairsSelect" class="style-dropdown" onchange="changePair(this.value)">
              <!-- Forex Major Pairs -->
              <option value="EUR/USD">ğŸ’¶ EUR/USD</option>
              <option value="GBP/USD">ğŸ’· GBP/USD</option>
              <option value="USD/JPY">ğŸ’´ USD/JPY</option>
              <option value="USD/CHF">ğŸ‡¨ğŸ‡­ USD/CHF</option>
              <option value="AUD/USD">ğŸ‡¦ğŸ‡º AUD/USD</option>
              <option value="USD/CAD">ğŸ‡¨ğŸ‡¦ USD/CAD</option>
              <option value="NZD/USD">ğŸ‡³ğŸ‡¿ NZD/USD</option>
              
              <!-- Forex Minor Pairs -->
              <option value="EUR/GBP">ğŸ’¶/ğŸ’· EUR/GBP</option>
              <option value="EUR/JPY">ğŸ’¶/ğŸ’´ EUR/JPY</option>
              <option value="GBP/JPY">ğŸ’·/ğŸ’´ GBP/JPY</option>
              <option value="EUR/CAD">ğŸ’¶/ğŸ‡¨ğŸ‡¦ EUR/CAD</option>
              <option value="AUD/JPY">ğŸ‡¦ğŸ‡º/ğŸ’´ AUD/JPY</option>
              
              <!-- Cryptocurrencies -->
              <option value="BTC/USD">â‚¿ Bitcoin/USD</option>
              <option value="ETH/USD">ğŸ”· Ethereum/USD</option>
              <option value="ADA/USD">ğŸŸ¥ Cardano/USD</option>
              <option value="SOL/USD">ğŸŸ¦ Solana/USD</option>
              <option value="XRP/USD">âš¡ Ripple/USD</option>
              <option value="DOT/USD">ğŸ”´ Polkadot/USD</option>
              <option value="DOGE/USD">ğŸ¶ Dogecoin/USD</option>
              <option value="LTC/USD">ğŸ”¶ Litecoin/USD</option>
              <option value="BNB/USD">ğŸ’ Binance Coin/USD</option>
              <option value="MATIC/USD">ğŸ”· Polygon/USD</option>
              
              <!-- Commodities -->
              <option value="XAU/USD">ğŸ¥‡ Gold/USD</option>
              <option value="XAG/USD">ğŸ¥ˆ Silver/USD</option>
              <option value="XPT/USD">ğŸ”§ Platinum/USD</option>
              <option value="XPD/USD">âš¡ Palladium/USD</option>
              
              <!-- Indices -->
              <option value="US30">ğŸ‡ºğŸ‡¸ Dow Jones</option>
              <option value="SPX500">ğŸ‡ºğŸ‡¸ S&P 500</option>
              <option value="NAS100">ğŸ‡ºğŸ‡¸ NASDAQ</option>
              <option value="GER40">ğŸ‡©ğŸ‡ª DAX 40</option>
              <option value="UK100">ğŸ‡¬ğŸ‡§ FTSE 100</option>
              <option value="JP225">ğŸ‡¯ğŸ‡µ Nikkei 225</option>
            </select>
            
            <!-- Pyramid Style Dropdown -->
            <select id="pyramidStyleSelect" class="style-dropdown" onchange="changePyramidStyle(this.value)">
              <option value="scalper">âš¡ Scalper (M15â†’M5â†’M1)</option>
              <option value="intraday">ğŸ“ˆ Intraday (H1â†’M15â†’M5â†’M1)</option>
              <option value="swing">ğŸ”„ Swing (H4â†’H1â†’M15â†’M5â†’M1)</option>
              <option value="daily" selected>ğŸ“… Daily (D1â†’H4â†’H1â†’M15â†’M5â†’M1)</option>
            </select>
          </div>
        </div>
        
        <div class="info" id="status">ğŸ”„ Loading market data...</div>
      </div>
      
      <div class="controls">
        <button class="size-btn" onclick="setPyramidSize('small')">ğŸ“± Compact</button>
        <button class="size-btn active" onclick="setPyramidSize('medium')">ğŸ“Š Standard</button>
        <button class="size-btn" onclick="setPyramidSize('large')">ğŸ–¥ï¸ Detailed</button>
      </div>
      
      <div class="update-info" id="updateInfo"></div>
      <div class="pyramid medium" id="pyramid"></div>
    </div>

    <div id="chart-tab" class="tab-content">
      <div class="chart-container">
        <div class="chart-controls">
          <!-- Timeframe Selection -->
          <select id="timeframeSelect" class="timeframe-select" onchange="updateChartTimeframe()">
            <option value="M1">M1</option>
            <option value="M5">M5</option>
            <option value="M15">M15</option>
            <option value="H1" selected>H1</option>
            <option value="H4">H4</option>
            <option value="D1">D1</option>
          </select>
          
          <!-- Chart Type -->
          <div class="chart-type-section">
            <select id="chartTypeSelect" class="chart-type-select" onchange="setChartType(this.value)">
              <option value="line">ğŸ“ˆ Line</option>
              <option value="area">ğŸŸ¦ Area</option>
              <option value="trend">ğŸ¯ Bull/Bear Trend</option>
              <option value="candlestick">ğŸ•¯ï¸ Candlestick</option>
            </select>
            
            <!-- Dynamic Color Pickers -->
            <div id="colorPickers" class="color-pickers">
              <!-- Color pickers will be dynamically shown based on chart type -->
            </div>
          </div>
          
          <!-- Chart Controls -->
          <button class="control-btn" id="crosshairBtn" onclick="toggleCrosshair()">âŠ•</button>
          <button class="control-btn" onclick="downloadChart()">ğŸ’¾ Save</button>
          <button class="control-btn" onclick="zoomIn()">ğŸ”</button>
    
          <button class="control-btn" onclick="resetZoom()">ğŸ”„</button>
          
          <!-- Current Price Display -->
          <span class="current-price" id="currentPrice">--</span>
          <span class="chart-status" id="chartStatus">Select TF</span>
        </div>
        
        <div class="chart-area">
          <!-- Enhanced Indicators Panel -->
          <div class="indicators-panel collapsed" id="indicatorsPanel">
            <div class="panel-header">
              <span class="panel-emoji" onclick="toggleIndicatorsPanel()">ğŸ“Š</span>
              <h3 onclick="toggleIndicatorsPanel()">Indicators & Settings</h3>
            </div>
            
            <!-- Indicators Dropdown -->
            <div class="indicators-dropdown-section">
              <select id="indicatorsDropdown" class="indicators-dropdown" onchange="addIndicatorFromDropdown(this.value)">
                <option value="">+ Add Indicator</option>
                <option value="sma">SMA</option>
                <option value="ema">EMA</option>
                <option value="rsi">RSI</option>
                <option value="macd">MACD</option>
                <option value="bollinger">Bollinger</option>
                <option value="stochastic">Stochastic</option>
                <option value="supportresistance">Support/Resistance</option>
              </select>
            </div>
            
            <!-- Active Indicators List -->
            <div class="indicators-list" id="indicatorsList">
              <!-- Active indicators with settings will be added here -->
            </div>
          </div>
          
          <!-- Main Chart Canvas with Axis Indicators Container -->
          <div class="chart-wrapper">
            <canvas id="mainChart"></canvas>
            <!-- Axis Indicators will be dynamically inserted here -->
          </div>
        </div>
      </div>
    </div>

    <div id="analysis-tab" class="tab-content">
<!-- Gauges Container -->
<div class="gauges-container" id="gauges-container">
    <div class="gauge-row">
        <div class="gauge-item" id="momentum-gauge">
            <div class="gauge-title">Momentum</div>
            <div class="gauge-container">
                <div class="gauge-arc">
                    <div class="gauge-arc-fill" id="momentum-arc"></div>
                </div>
                <div class="gauge-hub"></div>
                <div class="gauge-needle-container">
                    <div class="gauge-needle" id="momentum-needle">
                        <div class="needle-head"></div>
                    </div>
                </div>
                <div class="gauge-value-container">
                    <div class="gauge-score" id="momentum-score">50</div>
                    <div class="gauge-unit">%</div>
                </div>
                <div class="gauge-label-container">
                    <div class="gauge-label" id="momentum-label">Neutral</div>
                    <div class="gauge-indicator-dot" id="momentum-indicator"></div>
                </div>
                <div class="gauge-markers">
                    <div class="marker marker-0">0</div>
                    <div class="marker marker-25">25</div>
                    <div class="marker marker-50">50</div>
                    <div class="marker marker-75">75</div>
                    <div class="marker marker-100">100</div>
                </div>
            </div>
        </div>
        
        <div class="gauge-item" id="volatility-gauge">
            <div class="gauge-title">Volatility</div>
            <div class="gauge-container">
                <div class="gauge-arc">
                    <div class="gauge-arc-fill" id="volatility-arc"></div>
                </div>
                <div class="gauge-hub"></div>
                <div class="gauge-needle-container">
                    <div class="gauge-needle" id="volatility-needle">
                        <div class="needle-head"></div>
                    </div>
                </div>
                <div class="gauge-value-container">
                    <div class="gauge-score" id="volatility-score">50</div>
                    <div class="gauge-unit">%</div>
                </div>
                <div class="gauge-label-container">
                    <div class="gauge-label" id="volatility-label">Medium</div>
                    <div class="gauge-indicator-dot" id="volatility-indicator"></div>
                </div>
                <div class="gauge-markers">
                    <div class="marker marker-0">0</div>
                    <div class="marker marker-25">25</div>
                    <div class="marker marker-50">50</div>
                    <div class="marker marker-75">75</div>
                    <div class="marker marker-100">100</div>
                </div>
            </div>
        </div>
        
        <div class="gauge-item" id="strength-gauge">
            <div class="gauge-title">Strength</div>
            <div class="gauge-container">
                <div class="gauge-arc">
                    <div class="gauge-arc-fill" id="strength-arc"></div>
                </div>
                <div class="gauge-hub"></div>
                <div class="gauge-needle-container">
                    <div class="gauge-needle" id="strength-needle">
                        <div class="needle-head"></div>
                    </div>
                </div>
                <div class="gauge-value-container">
                    <div class="gauge-score" id="strength-score">50</div>
                    <div class="gauge-unit">%</div>
                </div>
                <div class="gauge-label-container">
                    <div class="gauge-label" id="strength-label">Moderate</div>
                    <div class="gauge-indicator-dot" id="strength-indicator"></div>
                </div>
                <div class="gauge-markers">
                    <div class="marker marker-0">0</div>
                    <div class="marker marker-25">25</div>
                    <div class="marker marker-50">50</div>
                    <div class="marker marker-75">75</div>
                    <div class="marker marker-100">100</div>
                </div>
            </div>
        </div>
        
        <div class="gauge-item" id="risk-gauge">
            <div class="gauge-title">Risk</div>
            <div class="gauge-container">
                <div class="gauge-arc">
                    <div class="gauge-arc-fill" id="risk-arc"></div>
                </div>
                <div class="gauge-hub"></div>
                <div class="gauge-needle-container">
                    <div class="gauge-needle" id="risk-needle">
                        <div class="needle-head"></div>
                    </div>
                </div>
                <div class="gauge-value-container">
                    <div class="gauge-score" id="risk-score">50</div>
                    <div class="gauge-unit">%</div>
                </div>
                <div class="gauge-label-container">
                    <div class="gauge-label" id="risk-label">Medium</div>
                    <div class="gauge-indicator-dot" id="risk-indicator"></div>
                </div>
                <div class="gauge-markers">
                    <div class="marker marker-0">0</div>
                    <div class="marker marker-25">25</div>
                    <div class="marker marker-50">50</div>
                    <div class="marker marker-75">75</div>
                    <div class="marker marker-100">100</div>
                </div>
            </div>
        </div>
    </div>
</div>

      <!-- Multi-Timeframe Strength -->
      <div class="analysis-section" id="timeframe-strength-section">
        <h3>ğŸ“ˆ Multi-Timeframe Strength</h3>
        <div class="timeframe-strength-container" id="timeframe-strength-container">
          <!-- Timeframe strength bars will be populated here -->
        </div>
      </div>

      <!-- Indicator Consensus -->
      <div class="analysis-section" id="indicator-consensus-section">
        <h3>ğŸ¯ Indicator Consensus</h3>
        <div class="consensus-container" id="consensus-container">
          <div class="consensus-meters">
            <div class="consensus-meter">
              <div class="meter-label">Trend Indicators</div>
              <div class="meter-bar">
                <div class="meter-fill" id="trend-consensus-fill" style="width: 0%"></div>
              </div>
              <div class="meter-value" id="trend-consensus-value">0%</div>
            </div>
            <div class="consensus-meter">
              <div class="meter-label">Momentum Indicators</div>
              <div class="meter-bar">
                <div class="meter-fill" id="momentum-consensus-fill" style="width: 0%"></div>
              </div>
              <div class="meter-value" id="momentum-consensus-value">0%</div>
            </div>
            <div class="consensus-meter">
              <div class="meter-label">Volatility Indicators</div>
              <div class="meter-bar">
                <div class="meter-fill" id="volatility-consensus-fill" style="width: 0%"></div>
              </div>
              <div class="meter-value" id="volatility-consensus-value">0%</div>
            </div>
          </div>
          <div class="consensus-summary" id="consensus-summary">
            <div class="consensus-status">Analyzing indicator alignment...</div>
          </div>
        </div>
      </div>

      <!-- Market Structure -->
      <div class="analysis-section" id="market-structure-section">
        <h3>ğŸ—ï¸ Market Structure</h3>
        <div class="structure-container" id="structure-container">
          <div class="structure-levels">
            <div class="levels-group">
              <h4>Resistance Levels</h4>
              <div class="levels-list" id="resistance-levels">
                <!-- Resistance levels will be populated here -->
              </div>
            </div>
            <div class="levels-group">
              <h4>Support Levels</h4>
              <div class="levels-list" id="support-levels">
                <!-- Support levels will be populated here -->
              </div>
            </div>
          </div>
          <div class="structure-trend">
            <div class="trend-indicator">
              <span class="trend-label">Primary Trend:</span>
              <span class="trend-value" id="primary-trend">Analyzing...</span>
            </div>
            <div class="trend-strength">
              <span class="trend-label">Trend Strength:</span>
              <div class="trend-bar">
                <div class="trend-fill" id="trend-strength-fill" style="width: 0%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Trading Setups -->
      <div class="analysis-section" id="trading-setup-section">
        <h3>ğŸ’° Trading Setups</h3>
        <div class="setups-container" id="setups-container">
          <div class="setup-cards" id="setup-cards">
            <!-- Trading setup cards will be populated here -->
          </div>
          <div class="setup-metrics">
            <div class="metric-item">
              <span class="metric-label">Avg. Risk/Reward:</span>
              <span class="metric-value" id="avg-risk-reward">1:1.5</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">Success Probability:</span>
              <span class="metric-value" id="success-probability">65%</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">Market Condition:</span>
              <span class="metric-value" id="market-condition">Trending</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Volume Analysis -->
      <div class="analysis-section" id="volume-analysis-section">
        <h3>ğŸ“Š Volume Analysis</h3>
        <div class="volume-container" id="volume-container">
          <div class="volume-metrics">
            <div class="volume-metric">
              <div class="volume-label">Volume Trend</div>
              <div class="volume-value" id="volume-trend">Neutral</div>
            </div>
            <div class="volume-metric">
              <div class="volume-label">Volume vs Avg</div>
              <div class="volume-value" id="volume-vs-avg">+15%</div>
            </div>
            <div class="volume-metric">
              <div class="volume-label">Volume Confirmation</div>
              <div class="volume-value" id="volume-confirmation">Strong</div>
            </div>
          </div>
          <div class="volume-bars">
            <div class="volume-bar-container">
              <div class="volume-bar-label">D1</div>
              <div class="volume-bar">
                <div class="volume-bar-fill" id="volume-d1" style="height: 0%"></div>
              </div>
            </div>
            <div class="volume-bar-container">
              <div class="volume-bar-label">H4</div>
              <div class="volume-bar">
                <div class="volume-bar-fill" id="volume-h4" style="height: 0%"></div>
              </div>
            </div>
            <div class="volume-bar-container">
              <div class="volume-bar-label">H1</div>
              <div class="volume-bar">
                <div class="volume-bar-fill" id="volume-h1" style="height: 0%"></div>
              </div>
            </div>
            <div class="volume-bar-container">
              <div class="volume-bar-label">M15</div>
              <div class="volume-bar">
                <div class="volume-bar-fill" id="volume-m15" style="height: 0%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Technical Summary & Signals -->
      <div class="analysis-section">
        <h3>ğŸ“Š Technical Summary</h3>
        <div id="technicalSummary">Loading analysis...</div>
      </div>
      <div class="analysis-section">
        <h3>ğŸ¯ Trading Signals</h3>
        <div class="signal-list" id="tradingSignals"></div>
      </div>
    </div>

    <div id="alerts-tab" class="tab-content">
      <div class="alerts-container">
        <div class="analysis-section">
          <h3>ğŸ”” Active Alerts</h3>
          <div id="activeAlerts">
            <div class="no-alerts">
              <div class="no-alerts-icon">ğŸ”•</div>
              <div class="no-alerts-text">No active alerts</div>
              <div class="no-alerts-subtext">Alerts will appear here when triggered</div>
            </div>
          </div>
        </div>
        <div class="analysis-section">
          <h3>âš™ï¸ Alert Settings</h3>
          <div id="alertSettings">
            <div class="alert-setting-group">
              <div class="alert-setting-item">
                <input type="checkbox" id="rsiAlert" checked onchange="toggleAlertSetting('rsiAlerts', this.checked)">
                <label for="rsiAlert">RSI Overbought/Oversold (70/30)</label>
              </div>
              <div class="alert-setting-item">
                <input type="checkbox" id="priceAlert" onchange="toggleAlertSetting('priceAlerts', this.checked)">
                <label for="priceAlert">Key Price Level Breaks</label>
              </div>
              <div class="alert-setting-item">
                <input type="checkbox" id="volumeAlert" checked onchange="toggleAlertSetting('volumeAlerts', this.checked)">
                <label for="volumeAlert">Volume Spikes (2x Average)</label>
              </div>
              <div class="alert-setting-item">
                <input type="checkbox" id="momentumAlert" checked onchange="toggleAlertSetting('momentumAlerts', this.checked)">
                <label for="momentumAlert">Momentum Shifts</label>
              </div>
            </div>
            <div class="alert-actions-global">
              <button class="alert-btn test" onclick="testAlertSystem()">Test Alert System</button>
              <button class="alert-btn clear" onclick="clearAllAlerts()">Clear All Alerts</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- =============================================================== -->
  <!-- âœ… CORRECTED SCRIPT LOADING ORDER -->
  <!-- =============================================================== -->
  
  <!-- Core Chart.js Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/luxon@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1"></script>
  
  <!-- Financial Charts Extension -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.0"></script>
  
  <!-- Additional Chart.js Plugins -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1"></script>

  <!-- Load main unified script FIRST -->
  <script src="app.js"></script>
  
  <!-- Then load modules -->
  <script src="analysis_alerts.js"></script>
</body>
</html>